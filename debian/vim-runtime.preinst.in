#!/bin/sh
set -e

vimcur="@VIMCUR@"
basedir=/usr/share/vim/$vimcur/doc

rm_diversion() {
  dpkg-divert --package vim-runtime --rename --remove "$1"
}

add_diversion() {
  dpkg-divert --package vim-runtime --add --rename \
    --divert "$1.vim-tiny" "$1"
}

major_upgrade() {
  oldver="${1#?:}"
  oldver="vim$(echo ${oldver%.*-*} | sed 's/\.//g')"
  if [ "$oldver" != "$vimcur" ]; then
    rm_diversion "/usr/share/vim/$oldver/doc/help.txt"
    rm_diversion "/usr/share/vim/$oldver/doc/tags"
    return 0
  fi
  return 1
}

# Add diversions for any non-upgrade operation or when upgrading across major
# upstream versions.
if [ "$1" != "upgrade" ] || major_upgrade $2; then
  add_diversion $basedir/help.txt
  add_diversion $basedir/tags
fi

#DEBHELPER#

exit 0
